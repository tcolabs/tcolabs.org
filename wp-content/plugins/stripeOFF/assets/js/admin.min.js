/*! WP Simple Pay Lite for Stripe - 2.0.3
 * https://wpsimplepay.com/
 * Copyright (c) Moonstone Media 2017
 * Licensed GPLv2+ */

var spAdmin={};!function(a){"use strict";var b,c;spAdmin={init:function(){b=a(document.body),c=b.find("#simpay-form-settings"),this.setupChosen(),this.addMediaFields(),this.handleMetaboxTabClick(),c.find(".simpay-tab-link").on("click.simpayTabLink",function(b){b.preventDefault(),spAdmin.handleInternalLinkToTabClicks(a(this))}),c.on("click.simpayImagePreview",".simpay-remove-image-preview",function(a){spAdmin.handleRemoveImagePreviewClick(a)}),c.find(".simpay-panel-field").on("click.simpaySectionToggle",".simpay-section-toggle",function(b){spAdmin.initSectionToggle(a(this))}),b.find(".simpay-button").on("click.simpayShowSpinner",function(b){spAdmin.showSpinner(a(this))}),b.find("#simpay-preview-button").on("click.simpayPreviewButton",function(b){spAdmin.handlePreviewButton(a(this),b)}),b.find("#post").on("keypress.simpaySubmitOnEnter",function(b){spAdmin.handleSubmitOnEnter(a(this))}),b.trigger("simpayAdminInit")},handleSubmitOnEnter:function(a){var b,c,d,e;13===(b=event.keyCode?event.keyCode:event.which)&&(c=a.closest("form"),d=c.find("#save-post"),e=c.find("#publish"),d.length>0?d.click():e.click())},handlePreviewButton:function(a,b){var c,d;b.preventDefault(),d=a.closest("form"),c=d.attr("action"),d.attr("action",a.data("action")),d.attr("target","_blank"),d.submit(),d.attr("action",c),d.attr("target","")},showSpinner:function(a){a.parent().find(".spinner").css("visibility","visible")},handleRemoveImagePreviewClick:function(a){a.preventDefault(),c.find(".simpay-image-preview-wrap").hide(),c.find("#_image_url").val("")},addMediaFields:function(){var b;a(".simpay-media-uploader").on("click",function(c){if(c.preventDefault(),window.simpayMediaUploaderInputField=a(this),b)return void b.open();b=wp.media.frames.file_frame=wp.media({title:spGeneral.i18n.mediaTitle,button:{text:spGeneral.i18n.mediaButtonText},multiple:!1}),b.on("select",function(){var c=b.state().get("selection").first().toJSON(),d=window.simpayMediaUploaderInputField.prev(),e="id"===d.data("fvalue")?c.id:c.url;a(".simpay-image-preview-wrap").show(),a(".simpay-image-preview").prop("src",e),d.val(e)}),b.open()})},setupChosen:function(){var b=a(".simpay-chosen-select, .simpay-chosen-search");b.chosen({disable_search_threshold:20}),b.chosen()},handleMetaboxTabClick:function(){var b=a("ul.simpay-tabs a"),c=a("div.simpay-panel"),d=b.parents("li"),e={};b.on("click",function(b){var e=a(this).parent(),f=a(a(this).attr("href"));b.preventDefault(),d.removeClass("active"),e.addClass("active"),c.addClass("simpay-panel-hidden"),f.removeClass("simpay-panel-hidden"),b.stopPropagation()}),location.hash.length&&(e=a('ul.simpay-tabs a[href="'+location.hash+'"]'),e.length&&e.click())},handleInternalLinkToTabClicks:function(a){var c=a.data("show-tab");b.find("."+c+"-tab a").click()},initSectionToggle:function(a){var b=a.data("show");a.is(":checked")?a.closest(".simpay-panel-field").parent().find(b).show():a.closest(".simpay-panel-field").parent().find(b).hide()}},a(document).ready(function(a){spAdmin.init()})}(jQuery);